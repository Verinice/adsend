!function(){let e=[],t=[],r=null,n=null,o=null,a=[];function l(e){if(!r)return;const t=Array.from(e.querySelectorAll(r)).filter((e=>!e.classList.contains("ad-send-banner")));if(!t.length)return;const n=t[Math.floor(Math.random()*t.length)],o=n.cloneNode(!0);return o.removeAttribute("style"),Array.from(o.querySelectorAll("[style]")).forEach((e=>e.removeAttribute("style"))),o.className=n.className+" ad-send-banner",c(o,0),Array.from(e.querySelectorAll(".ad-send-banner")).forEach((e=>{e!==o&&e.remove()})),n.nextSibling?e.insertBefore(o,n.nextSibling):e.appendChild(o),o}function c(t,r){if(!e.length)return;const o=e[r%e.length],a=t.querySelector("a");if(a&&o.targetUrl&&(a.setAttribute("href",o.targetUrl),a.setAttribute("target","_blank"),a.setAttribute("rel","noopener noreferrer")),n&&o.imageUrl){const e=t.querySelector(n);e&&(e.style.backgroundImage=`url('${o.imageUrl}')`,e.style.backgroundSize="cover",e.style.backgroundPosition="center",e.style.backgroundRepeat="no-repeat")}else if(o.imageUrl){const e=t.querySelector("img");e&&e.setAttribute("src",o.imageUrl)}}async function i(){if(o=document.currentScript&&document.currentScript.getAttribute("data-property")||null,!o)return;await async function(){let a;try{const e=await fetch("https://verinice.github.io/adsend/env.txt");if(!e.ok)throw new Error("Could not load env.txt");const t=(await e.text()).match(/^CONFIG_URL\s*=\s*(.+)$/m);if(!t)throw new Error("CONFIG_URL not found in env.txt");a=t[1].trim()}catch(e){throw new Error("[AdSend] CONFIG_URL is required in env.txt: "+e.message)}const l=await fetch(a);if(!l.ok)throw new Error("Could not load ad-config.json");const c=await l.json(),i=Array.isArray(c)?c.find((e=>e.property_id===o)):null;if(!i)throw new Error("No config for propertyId");e=i.banners||[],t=Array.isArray(i.containers)?i.containers:[],t.length&&"object"==typeof t[0]&&t[0].name&&(t=t.map((e=>e.name)).filter(Boolean)),r=i.copySiblingSelector||null,n=i.imageSelector||null}();let i=[];t.forEach((e=>{const t=Array.from(document.querySelectorAll(e));i=i.concat(t)})),e.length&&i.length&&(i=function(e){let t,r,n=e.length;for(;n;)r=Math.floor(Math.random()*n--),t=e[n],e[n]=e[r],e[r]=t;return e}(i),i.forEach((t=>{const r=l(t);r&&function(t,r){let n=0;const o=setInterval((()=>{n=(n+1)%e.length,c(r,n)}),3e4);a.push(o)}(0,r)})))}window.AdSend={init:i,state:{get banners(){return e},get containerSelectors(){return t},get copySiblingSelector(){return r},get imageSelector(){return n},get propertyId(){return o}},updateAdContent:c,placeAd:l},document.currentScript&&document.currentScript.getAttribute("data-property")&&i()}();